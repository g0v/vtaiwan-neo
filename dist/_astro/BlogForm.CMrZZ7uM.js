import{v as d,w as I}from"./runtime-dom.esm-bundler.CNPrGPaq.js";import{o as h,s as w,r as v,a as k,g as _,b as S,d as D,c as f}from"./firebase.Dd7E2CAK.js";import U from"./GoogleLogin.DMZDHwcp.js";import{_ as V}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as g,a as t,b as F,d as R,t as m,w as u,r as y,e as B,o as L,f as c}from"./runtime-core.esm-bundler.CxImSglf.js";const C={__name:"BlogForm",setup(N,{expose:e}){e(),console.log("BlogForm component mounted");const l=y(null),o=y(!1),n=B({title:"",date:new Date().toISOString().split("T")[0],summary:"",content:"",tagsInput:""});L(()=>{console.log("Setting up auth state listener in BlogForm"),h(f,r=>{console.log("Auth state changed in BlogForm:",r),l.value=r})});const b=async()=>{console.log("Getting next index...");try{const i=(await _(S)).val()||{};console.log("Current blogs data:",i);const a=Object.keys(i).map(Number),x=a.length>0?Math.max(...a)+1:0;return console.log("Next index will be:",x),x}catch(r){throw console.error("Error in getNextIndex:",r),r}},p={user:l,isSubmitting:o,formData:n,getNextIndex:b,goBack:()=>{console.log("Going back to blogs list"),window.location.href="/blogs"},handleLogout:async()=>{try{console.log("Logging out..."),await w(f),console.log("Logout successful"),window.location.href="/blogs"}catch(r){console.error("Logout error:",r),alert("登出時發生錯誤，請稍後再試")}},handleSubmit:async()=>{if(!l.value){console.log("User not logged in, cannot submit"),alert("請先登入才能發布文章");return}console.log("Form submitted with data:",n);try{o.value=!0,console.log("Getting next index for new blog...");const r=await b(),i={title:n.title,author:l.value.displayName,authorId:l.value.uid,authorPhotoURL:l.value.photoURL,date:n.date,summary:n.summary,content:n.content,tags:n.tagsInput.split(",").map(a=>a.trim()).filter(a=>a)};console.log("Prepared blog data:",i),console.log("Will be saved at path:",`blogs/${r}`),await k(v(D,`blogs/${r}`),i),console.log("Blog saved successfully"),window.location.href="/blogs"}catch(r){console.error("Error posting blog:",r),console.error("Error details:",{message:r.message,code:r.code,stack:r.stack}),alert("發布文章時發生錯誤，請稍後再試")}finally{o.value=!1,console.log("Form submission completed")}},ref:y,reactive:B,onMounted:L,get auth(){return f},get database(){return D},get blogsRef(){return S},get get(){return _},get set(){return k},get dbRef(){return v},get onAuthStateChanged(){return h},get signOut(){return w},GoogleLogin:U};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}},G={key:0,class:"text-center py-8"},O={key:1},j={class:"flex justify-between items-center mb-6 bg-white rounded-lg shadow-md p-4"},q={class:"flex items-center space-x-4"},E=["src","alt"],M={class:"font-medium text-gray-900"},A={class:"text-sm text-gray-500"},P={class:"flex justify-between items-center"},T={class:"text-sm text-gray-600"},W={class:"flex space-x-4"},z=["disabled"];function H(N,e,l,o,n,b){return c(),g("div",null,[o.user?(c(),g("div",O,[t("div",j,[t("div",q,[o.user.photoURL?(c(),g("img",{key:0,src:o.user.photoURL,alt:o.user.displayName,class:"w-10 h-10 rounded-full"},null,8,E)):R("",!0),t("div",null,[t("p",M,m(o.user.displayName),1),t("p",A,m(o.user.email),1)])]),t("button",{onClick:o.handleLogout,class:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"}," 登出 ")]),t("form",{onSubmit:I(o.handleSubmit,["prevent"]),class:"space-y-6 bg-white rounded-lg shadow-md p-6"},[t("div",null,[e[6]||(e[6]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-1"},"標題",-1)),u(t("input",{type:"text",id:"title","onUpdate:modelValue":e[0]||(e[0]=s=>o.formData.title=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,o.formData.title]])]),t("div",null,[e[7]||(e[7]=t("label",{for:"date",class:"block text-sm font-medium text-gray-700 mb-1"},"發布日期",-1)),u(t("input",{type:"date",id:"date","onUpdate:modelValue":e[1]||(e[1]=s=>o.formData.date=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,o.formData.date]])]),t("div",null,[e[8]||(e[8]=t("label",{for:"summary",class:"block text-sm font-medium text-gray-700 mb-1"},"摘要",-1)),u(t("textarea",{id:"summary","onUpdate:modelValue":e[2]||(e[2]=s=>o.formData.summary=s),required:"",rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,o.formData.summary]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700 mb-1"},"內容",-1)),u(t("textarea",{id:"content","onUpdate:modelValue":e[3]||(e[3]=s=>o.formData.content=s),required:"",rows:"10",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,o.formData.content]])]),t("div",null,[e[10]||(e[10]=t("label",{for:"tags",class:"block text-sm font-medium text-gray-700 mb-1"},"標籤（用逗號分隔）",-1)),u(t("input",{type:"text",id:"tags","onUpdate:modelValue":e[4]||(e[4]=s=>o.formData.tagsInput=s),placeholder:"例如：vTaiwan, 數位民主, 開放政府",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[d,o.formData.tagsInput]])]),t("div",P,[t("div",T," 發布者："+m(o.user.displayName),1),t("div",W,[t("button",{type:"button",onClick:o.goBack,class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors"}," 取消 "),t("button",{type:"submit",disabled:o.isSubmitting,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"},m(o.isSubmitting?"發布中...":"發布文章"),9,z)])])],32)])):(c(),g("div",G,[e[5]||(e[5]=t("p",{class:"text-gray-600 mb-4"},"請先登入才能發布文章",-1)),F(o.GoogleLogin)]))])}const tt=V(C,[["render",H]]);export{tt as default};
